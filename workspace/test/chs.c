#include <stdio.h>
#include <string.h>

typedef unsigned short uint16;
typedef unsigned char uint8;

static uint16 in_cksum(uint16 *addr, int len) {
	int     sum;
	int     isOdd;
	uint16  *pEnd;

	isOdd = len & 1;
	len >>= 1;
	sum = 0;
	pEnd = addr + len;
	while(addr != pEnd)
		sum += *addr++;

	if(isOdd) {
		uint16 tmp = 0;
		*(uint8*)&tmp = *(uint8*)addr;
		sum += tmp;
	}

	while(sum >> 16)
		sum = (sum & 0xFFFF) + (sum >> 16);

	return (uint16) ~sum;
}

char data[2048];
void main(int argc, char **argv) {
	// char data[] = {0x08,0x00,0x00,0x00,0x01,0x00,0x00,0x19,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,};
	// char data[] = {0x08,0x00,0x00,0x00,0x01,0x00,0x00,0x19,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x6b,0x6c,0x6d,0x6e,0x6f,0x70,0x71,0x72,0x73,0x74,0x75,0x76,0x77,0x61,0x62,0x63,0x64,0x65,0x66,0x67,0x68,0x69,};
	int len = strlen(argv[1]) / 2;
	printf("len=%d\n", len);
	int i;
	for(i = len - 1; i >= 0; i--) {
		argv[1][i*2 + 2] = '\0';
		data[i] = strtol(argv[1] + i*2, NULL, 16);
	}

	data[2] = data[3] = 0;
	printf("123: %04X\n", in_cksum((uint16*)data, len));
}
